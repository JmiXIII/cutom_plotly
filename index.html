<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>onRecord</title>
    <script src="https://docs.getgrist.com/grist-plugin-api.js"></script>
    <script src="https://docs.getgrist.com/grist-plugin-api.js"></script>
  </head>
  <body>
    <pre id="readout">Waiting for data...</pre>
    <script>
      grist.ready();
      grist.onRecord(function(record) {
        document.getElementById('readout').innerHTML = JSON.stringify(record, null, 2);
      });
  <div id="myDiv">plotly</div>
  <script>
    // Initialize the widget API
    var api = new GristWidget.API();

    // Define a function to plot the data
    function plotData(data) {
      var x = data.map(row => row.name);
      var y = data.map(row => row.count);
      var trace = {
        x: x,
        y: y,
        type: 'bar'
      };
      Plotly.newPlot('myDiv', [trace]);
    }

    // Fetch the data from the document
    api.fetchRecords('Animals').then(data => {
      plotData(data);
    });

    // Listen for data changes and update the plot
    api.onRecordsChanged('Animals', (changes) => {
      api.fetchRecords('Animals').then(data => {
        plotData(data);
      });
    });
  </script>
</body>
</html>
